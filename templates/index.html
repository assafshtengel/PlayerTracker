<!DOCTYPE html>
<html lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>מערכת ניתוח ביצועים</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <!-- ספריות ל-PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.min.js"></script>
</head>
<body>
    <header>
        <div id="logo">אסף שטנגל - מאמן מנטלי</div>
    </header>

    <main>
        <section id="role-selection-container">
            <div class="game-info-container">
                <h1>ברוך הבא למערכת ניתוח ביצועים</h1>
                <p>בחר את התפקיד שלך:</p>
                <div class="role-buttons">
                    <button class="role-button" onclick="selectRole('player')">שחקן</button>
                    <button class="role-button" onclick="selectRole('coach')">מאמן</button>
                    <button class="role-button" onclick="selectRole('analyst')">אנליסט</button>
                </div>
            </div>
        </section>

        <section id="login-container" class="hidden game-info-container">
            <h2>כניסת שחקן</h2>
            <p>הכנס קוד גישה:</p>
            <div class="input-group">
                <input type="text" id="access-code" placeholder="קוד גישה">
                <button onclick="checkAccessCode()">אישור</button>
            </div>
        </section>

        <section id="user-input-container" class="hidden game-info-container">
            <h2>פרטי שחקן</h2>
            <div class="input-group">
                <input type="text" id="player-name" placeholder="שם השחקן">
                <input type="text" id="team-name" placeholder="שם הקבוצה">
                <select id="player-position">
                    <option value="" selected disabled>בחר תפקיד</option>
                    <option value="שוער">שוער</option>
                    <option value="בלם">בלם</option>
                    <option value="מגן">מגן</option>
                    <option value="קשר">קשר</option>
                    <option value="חלוץ">חלוץ</option>
                    <option value="כנף">כנף</option>
                </select>
                <button onclick="submitUserInfo()">התחל</button>
            </div>
        </section>

        <section id="actions-selection-container" class="hidden game-info-container">
            <h2>בחירת פעולות</h2>
            <p>בחר בין 6 ל-10 פעולות להתמקד בהן.</p>
            <h3>פעולות מקצועיות:</h3>
            <div class="actions-grid" id="professional-actions"></div>
            <h3>פעולות מנטאליות:</h3>
            <div class="actions-grid" id="mental-actions"></div>
            <h3>פעולות מותאמות אישית:</h3>
            <div class="actions-grid" id="custom-actions"></div>
            <div class="input-group">
                <input type="text" id="custom-action-input" placeholder="הוסף פעולה מותאמת אישית">
                <button onclick="addCustomAction()">הוסף פעולה</button>
            </div>
            <button onclick="confirmActions()">אישור</button>
        </section>

        <section id="start-game-container" class="hidden game-info-container">
            <h2>התחלת משחק</h2>
            <button class="start-game-btn" onclick="startGame()">התחל משחק</button>
        </section>

        <!-- מאמן הגדרת משחק -->
        <section id="coach-game-info-container" class="hidden game-info-container">
            <h2>הגדרת משחק למאמן</h2>
            <div class="input-group">
                <input type="text" id="coach-teamA" placeholder="שם קבוצה א'">
                <h3>צבע קבוצה א'</h3>
                <div id="coach-teamA-color-palette" class="color-palette"></div>
                <button id="coach-teamA-change-color" class="blue-btn hidden" onclick="resetTeamAColor()">שנה צבע</button>
                
                <input type="text" id="coach-teamB" placeholder="שם קבוצה ב'">
                <h3>צבע קבוצה ב'</h3>
                <div id="coach-teamB-color-palette" class="color-palette"></div>
                <button id="coach-teamB-change-color" class="blue-btn hidden" onclick="resetTeamBColor()">שנה צבע</button>

                <h3>שנתון</h3>
                <select id="coach-year-group">
                    <option value="טרום ג">טרום ג</option>
                    <option value="טרום ב">טרום ב</option>
                    <option value="טרום א">טרום א</option>
                    <option value="ילדים ג">ילדים ג</option>
                    <option value="ילדים ב">ילדים ב</option>
                    <option value="ילדים א">ילדים א</option>
                    <option value="נערים ג">נערים ג</option>
                    <option value="נערים ב">נערים ב</option>
                    <option value="נערים א">נערים א</option>
                    <option value="נוער">נוער</option>
                    <option value="בוגרים">בוגרים</option>
                </select>

                <h3>תאריך</h3>
                <input type="date" id="coach-game-date">
                
                <button class="blue-btn" onclick="goToCoachGoals()">המשך</button>
            </div>
        </section>

        <!-- מטרות למאמן (קבוצתיות) -->
        <section id="coach-goals-container" class="hidden game-info-container" style="max-width:800px;">
            <h2 style="font-size:28px;">בחירת מטרות קבוצתיות</h2>
            <p>בחר מטרות לפי חוליות וכן הוסף מטרות משלך לחוליות. נצל את המקום כדי לראות היטב את כל האפשרויות.</p>
            <h3>שוער</h3>
            <div class="actions-grid" id="coach-goals-keeper"></div>

            <h3>הגנה</h3>
            <div class="actions-grid" id="coach-goals-defense"></div>

            <h3>קישור</h3>
            <div class="actions-grid" id="coach-goals-midfield"></div>

            <h3>התקפה</h3>
            <div class="actions-grid" id="coach-goals-attack"></div>

            <h3>הוסף מטרה לחוליה</h3>
            <div class="input-group">
                <select id="coach-custom-goal-line">
                    <option value="שוער">שוער</option>
                    <option value="הגנה">הגנה</option>
                    <option value="קישור">קישור</option>
                    <option value="התקפה">התקפה</option>
                </select>
                <input type="text" id="coach-custom-goal-input" placeholder="הוסף מטרה לחוליה">
                <button class="blue-btn" onclick="addCoachCustomGoal()">הוסף מטרה</button>
            </div>

            <div class="actions-grid" id="coach-goals-custom-hint" style="font-size:20px;">
                <label><input type="checkbox" id="coach-ask-personal-goals" style="width:20px;height:20px;"> מעוניין לתת גם מטרות אישיות לשחקנים?</label>
            </div>

            <div id="coach-personal-goals-notes" class="notes-container"></div>

            <button class="blue-btn" onclick="finishCoachSetup()">אישור</button>
        </section>

        <div id="coach-custom-goal-popup" class="popup">
            <span class="close-btn" onclick="closeCoachCustomGoalPopup()">X</span>
            <div class="popup-content" id="coach-custom-goal-popup-content"></div>
        </div>

        <div id="coach-goal-limit-popup" class="popup">
            <span class="close-btn" onclick="closeCoachGoalLimitPopup()">X</span>
            <div class="popup-content">
                <p>הגעת למגבלת הפעולות האפשריות בחולייה זו (30 מטרות).</p>
            </div>
        </div>

        <!-- מטרות אישיות לשחקן -->
        <div id="personal-goals-popup" class="popup">
            <span class="close-btn" onclick="closePersonalGoalsPopup()">X</span>
            <div class="popup-content" id="personal-goals-popup-content">
                <h3>מטרות אישיות לשחקן</h3>
                <input type="text" id="personal-player-name" class="large-input" placeholder="שם השחקן">
                <div class="checkbox-group" style="padding:10px;">
                    <p><strong>בחר תפקיד (ניתן לבחור יותר מאחד):</strong></p>
                    <label><input type="checkbox" name="personal-player-roles" value="שוער"> שוער</label>
                    <label><input type="checkbox" name="personal-player-roles" value="בלם"> בלם</label>
                    <label><input type="checkbox" name="personal-player-roles" value="מגן"> מגן</label>
                    <label><input type="checkbox" name="personal-player-roles" value="קשר"> קשר</label>
                    <label><input type="checkbox" name="personal-player-roles" value="חלוץ"> חלוץ</label>
                    <label><input type="checkbox" name="personal-player-roles" value="כנף"> כנף</label>
                </div>
                <button class="blue-btn" onclick="confirmPersonalPlayerInfo()">אישור</button>
            </div>
        </div>

        <div id="personal-goals-selection-popup" class="popup">
            <span class="close-btn" onclick="closePersonalGoalsSelectionPopup()">X</span>
            <div class="popup-content" id="personal-goals-selection-popup-content">
                <h3>בחר מטרות אישיות (מתוך התפקידים שנבחרו)</h3>
                <div id="personal-goals-selection-list" class="actions-grid"></div>
                <h3>הוסף מטרה מותאמת לשחקן</h3>
                <div class="input-group">
                    <input type="text" id="personal-player-custom-goal-input" placeholder="הוסף מטרה לשחקן">
                    <button class="blue-btn" onclick="addPersonalPlayerCustomGoal()">הוסף</button>
                </div>
                <button class="blue-btn" onclick="finishPersonalPlayerGoalsSelection()">אישור</button>
            </div>
        </div>

        <div id="personal-goals-numeric-popup" class="popup">
            <span class="close-btn" onclick="closePersonalGoalsNumericPopup()">X</span>
            <div class="popup-content numeric-content" id="personal-goals-numeric-popup-content">
                <h3>הזן יעדים מספריים למטרות</h3>
                <div id="personal-goals-numeric-table"></div>
                <button class="blue-btn" onclick="finishPersonalGoalsNumeric()">אישור</button>
            </div>
        </div>

        <div id="personal-goals-another-player-popup" class="popup">
            <span class="close-btn" onclick="closePersonalGoalsAnotherPlayerPopup()">X</span>
            <div class="popup-content" style="display:flex;flex-direction:column;align-items:flex-start;gap:20px;">
                <p>האם להוסיף מטרות אישיות לשחקן נוסף?</p>
                <div style="display:flex;gap:20px;">
                    <button class="blue-btn" onclick="addAnotherPersonalPlayer(true)">כן</button>
                    <button class="blue-btn" onclick="addAnotherPersonalPlayer(false)">לא</button>
                </div>
            </div>
        </div>

        <section id="final-summary-container" class="hidden game-info-container" style="max-width:800px;">
            <h2 style="font-size:28px;">סיכום כל המטרות</h2>
            <p id="final-summary-game-info" style="font-size:20px;"></p>
            <div id="final-summary-content" style="font-size:18px;line-height:1.6;"></div>
            <button class="blue-btn" id="download-pdf-btn" onclick="downloadFinalSummaryPDF()">הורד PDF</button>
            <button class="blue-btn" id="continue-to-live-btn" onclick="goToCoachLiveGame()">המשך למשחק</button>
        </section>

        <section id="coach-live-game-container" class="hidden game-info-container">
            <h2>התחל משחק בזמן אמת</h2>
            <p>לאחר שהכול הוגדר, ניתן להתחיל מעקב בזמן אמת.</p>
            <button class="blue-btn" onclick="startCoachLiveGame()">התחל משחק בזמן אמת</button>
        </section>

        <!-- עידכון פעולות בזמן משחק -->
        <section id="coach-live-update-container" class="hidden game-info-container live-style" style="max-width:1000px;">
            <div id="live-header" style="text-align:center;margin-bottom:20px;">
                <h2 style="font-size:28px;">עדכון פעולות בזמן משחק</h2>
                <p style="font-size:20px;" id="match-info"></p>
                <p style="font-size:20px;">דקה: <span id="coach-live-minute-counter">0</span></p>
            </div>
            <div id="live-update-content"></div>
        </section>

        <div id="game-timer" class="hidden">
            דקה: <span id="minute-counter">0</span>
        </div>

        <h2 id="actions-title" class="hidden">רישום פעולות</h2>

        <section id="notes-container" class="hidden">
            <button class="blue-btn" onclick="openGeneralNotePopup()">הוסף הערה</button>
        </section>

        <section id="game-actions-container" class="hidden">
            <h3>פעולות מקצועיות:</h3>
            <div id="prof-actions-chosen"></div>
            <h3>פעולות מנטאליות:</h3>
            <div id="mental-actions-chosen"></div>
            <h3>פעולות מותאמות אישית:</h3>
            <div id="custom-actions-chosen"></div>
        </section>

        <div id="end-buttons-container" class="hidden">
            <button id="end-half" class="half-time-btn" onclick="endHalfTime()">סיים מחצית</button>
            <button class="blue-btn" onclick="showAllActionsDuringMatch()">הצג פעולות</button>
            <button id="end-game" class="end-game-btn" onclick="endGame()">סיים משחק</button>
        </div>

        <div id="half-time-summary-popup" class="popup">
            <span class="close-btn" onclick="resumeHalf()">X</span>
            <div class="popup-content">
                <div id="half-summary-content"></div>
                <div id="half-general-note-display">
                    <h3>הערות מחצית:</h3>
                    <ul id="half-parent-notes-list"></ul>
                </div>
                <button class="blue-btn" onclick="showHalfAllActionsPopup()">סכם מחצית</button>
            </div>
        </div>

        <!-- פופאפ סיכום מחצית מלא -->
        <div id="half-all-actions-popup" class="popup">
            <span class="close-btn" onclick="closeHalfAllActionsPopup()">X</span>
            <div class="popup-content">
                <h3>כל הפעולות במחצית</h3>
                <div id="half-all-actions-list"></div>
            </div>
        </div>

        <div id="game-summary-popup" class="popup">
            <span class="close-btn" onclick="closePopup()">X</span>
            <div class="popup-content">
                <div id="summary-content"></div>
                <div id="general-note-display" class="hidden">
                    <h3>הערות:</h3>
                    <ul id="parent-notes-list"></ul>
                </div>
                <button class="view-all-btn" onclick="showAllActions()">צפה בכל הפעולות</button>
                <button class="blue-btn" onclick="downloadPDF()">שמור כ-PDF</button>
            </div>
        </div>

        <div id="actions-detail-popup" class="popup">
            <span class="close-btn big-close" onclick="closeAllActionsPopup()">X</span>
            <div class="popup-content">
                <h3>כל הפעולות</h3>
                <div id="all-actions-list"></div>
            </div>
        </div>

        <div id="general-note-popup" class="popup">
            <span class="close-btn" onclick="closeGeneralNotePopup()">X</span>
            <div class="popup-content">
                <h3>הוסף הערה:</h3>
                <textarea id="general-note-text"></textarea>
                <button class="blue-btn" onclick="saveGeneralNote()">שמור הערה</button>
            </div>
        </div>

        <div id="feedback-popup" class="popup hidden">
            <span class="close-btn" onclick="closeFeedbackPopup()">X</span>
            <div class="popup-content">
                <h3>משוב</h3>
                <p id="feedback-text"></p>
            </div>
        </div>

        <div id="reopen-summary-container" class="hidden">
            <button class="blue-btn" onclick="reopenSummary()">פתח שוב את הסיכום</button>
        </div>

        <!-- אנליסט -->
        <section id="analyst-game-info-container" class="hidden game-info-container">
            <h2>הגדרת משחק לאנליסט</h2>
            <div class="input-group">
                <input type="text" id="analyst-teamA" placeholder="שם קבוצה א'">
                <input type="text" id="analyst-teamB" placeholder="שם קבוצה ב'">
                <input type="date" id="analyst-game-date">
                <button onclick="submitAnalystGameInfo()">אישור</button>
            </div>
            <h3>צבע קבוצה א'</h3>
            <div id="teamA-color-palette" class="color-palette"></div>
            <h3>צבע קבוצה ב'</h3>
            <div id="teamB-color-palette" class="color-palette"></div>
        </section>

        <section id="analyst-setup-container" class="hidden game-info-container">
            <h2>הוספת שחקנים</h2>
            <div class="input-group">
                <input type="text" id="analyst-player-name" placeholder="שם השחקן">
                <input type="text" id="analyst-player-number" placeholder="מס' חולצה">
                <select id="analyst-player-position">
                    <option value="" disabled selected>בחר תפקיד</option>
                    <option value="שוער">שוער</option>
                    <option value="בלם">בלם</option>
                    <option value="מגן">מגן</option>
                    <option value="קשר">קשר</option>
                    <option value="חלוץ">חלוץ</option>
                    <option value="כנף">כנף</option>
                </select>
                <select id="analyst-player-team-select"></select>
                <button id="add-player-btn" class="blue-btn" disabled onclick="addAnalystPlayer()">הוסף שחקן</button>
            </div>
            <h3>שחקנים שנוספו:</h3>
            <div id="analyst-players-list"></div>
            <button class="blue-btn" onclick="submitAnalystSetup()">הבא</button>
        </section>

        <section id="analyst-actions-container" class="hidden game-info-container">
            <h2>בחירת פעולות לאנליסט</h2>
            <div id="analyst-players-actions"></div>
            <button class="blue-btn" onclick="submitAnalystActions()">הבא</button>
        </section>

        <section id="analyst-marking-container" class="hidden game-info-container">
            <h2>רישום פעולות בזמן אמת (אנליסט)</h2>
            <div id="analyst-marking-players"></div>
            <textarea id="analyst-general-note" placeholder="הערה כללית (לא חובה)"></textarea>
            <button class="blue-btn" onclick="finishAnalystGame()">סיום משחק אנליסט</button>
        </section>

        <section id="analyst-final-summary-container" class="hidden game-info-container">
            <h2>סיכום משחק אנליסט</h2>
            <div id="analyst-final-data"></div>
            <button class="blue-btn" onclick="downloadPDFAnalyst()">הורד PDF</button>
        </section>

    </main>

    <footer>
        <p>&copy; 2024 אסף שטנגל - כל הזכויות שמורות.</p>
    </footer>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>
